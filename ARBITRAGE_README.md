# 跨池套利监控功能

## 功能概述

本系统新增了跨池套利监控功能，可以实时监控两个Uniswap V3池子的价格差异，检测套利机会并计算预估利润。

## 使用方法

### 启动套利监控

```bash
# 基本用法
./uniswapv3-tick-state -arbitrage -pool1 <池子1地址> -pool2 <池子2地址>

# 示例：监控两个ETH/USDT池子
./uniswapv3-tick-state -arbitrage \
  -pool1 0xBe141893E4c6AD9272e8C04BAB7E6a10604501a5 \
  -pool2 0x9F599F3D64a9D99eA21e68127Bb6CE99f893DA61

# 指定配置文件和数据库路径
./uniswapv3-tick-state -arbitrage \
  -pool1 0xBe141893E4c6AD9272e8C04BAB7E6a10604501a5 \
  -pool2 0x9F599F3D64a9D99eA21e68127Bb6CE99f893DA61 \
  -c config.json \
  -db .db
```

### 参数说明

- `-arbitrage`: 启用套利监控模式
- `-pool1`: 第一个池子的合约地址
- `-pool2`: 第二个池子的合约地址
- `-c`: 配置文件路径（可选，默认config.json）
- `-db`: 数据库路径（可选，默认.db）

## 输出说明

当检测到套利机会时，系统会输出以下信息：

```
=== 套利机会检测 ===
时间: 2024-01-15 10:30:45
池子1: 0xBe141893E4c6AD9272e8C04BAB7E6a10604501a5 (价格: 1.234567)
池子2: 0x9F599F3D64a9D99eA21e68127Bb6CE99f893DA61 (价格: 1.230000)
价格差异: 0.3700%
套利方向: pool2_to_pool1
预估利润 (1 ETH): 0.003700 ETH
==================
```

### 字段说明

- **时间**: 检测到套利机会的时间
- **池子1/池子2**: 两个池子的合约地址和当前价格
- **价格差异**: 两个池子之间的价格差异百分比
- **套利方向**: 
  - `pool1_to_pool2`: 从池子1买入，在池子2卖出
  - `pool2_to_pool1`: 从池子2买入，在池子1卖出
- **预估利润**: 假设交易1 ETH的预估利润

## 套利阈值

系统设置了最小套利阈值（0.1%），只有当价格差异超过此阈值时才会报告套利机会。这个阈值可以在代码中调整。

## 价格计算

系统使用Uniswap V3的标准价格公式：
```
price = 1.0001^tick
```

其中tick是池子的当前tick值。

## 利润计算

利润计算基于以下假设：
1. 交易金额为1 ETH
2. 在低价池买入USDT
3. 在高价池卖出USDT获得ETH
4. 利润 = 卖出获得的ETH - 买入花费的ETH

## 注意事项

1. **实时性**: 系统每秒检查一次价格差异
2. **网络延迟**: 价格获取可能有网络延迟
3. **手续费**: 当前计算未考虑交易手续费
4. **滑点**: 未考虑大额交易可能造成的滑点
5. **流动性**: 未检查池子的流动性是否足够

## 停止监控

按 `Ctrl+C` 可以停止套利监控。

## 日志

系统会记录以下日志信息：
- 启动信息：池子地址、配置等
- 错误信息：网络错误、数据获取失败等
- 停止信息：程序正常退出

## 扩展功能

可以根据需要扩展以下功能：
1. 添加更多池子监控
2. 实现自动交易执行
3. 添加更复杂的利润计算（考虑手续费、滑点等）
4. 添加风险控制机制
5. 实现Web界面展示 